================================================================================
MAGNUM OPUS - HOMING PROJECTILE TARGETING CODE AUDIT
================================================================================
Last Updated: January 18, 2026

This document lists all homing projectile code that uses `target.Center` for
direction calculations. These may need to be changed to target a position
slightly offset from center to account for enemy size and projectile travel time.

LEGEND:
  [HOMING] = Homing direction calculation - SHOULD BE REVIEWED FOR OFFSET
  [FIRE]   = Direction to fire a new projectile - SHOULD BE REVIEWED FOR OFFSET  
  [VFX]    = Visual effect direction only - OK AS-IS
  [DIST]   = Distance check only - OK AS-IS
  [ROT]    = Rotation facing only - OK AS-IS

================================================================================
CONTENT/SWANLAKE/ - 7 INSTANCES
================================================================================

1. IridescentWingspan.cs - LINE 293
   [HOMING] Vector2 targetDirection = (closestTarget.Center - Projectile.Center).SafeNormalize(Vector2.Zero);
   Context: Projectile homes toward target with lerp
   Priority: MEDIUM - Should offset target position

2. FeatheroftheIridescentFlock.cs - LINE 444
   [FIRE] Vector2 direction = (target.Center - Projectile.Center).SafeNormalize(Vector2.UnitY);
   Context: FireFlare() - Crystal fires homing flare toward target
   Priority: LOW - The spawned flare itself homes, so initial direction less critical

3. FeatheroftheIridescentFlock.cs - LINE 544
   [VFX] Vector2 toTarget = (target.Center - Projectile.Center).SafeNormalize(Vector2.Zero);
   Context: Visual sparks direction toward target on explosion
   Priority: NONE - VFX only

4. FeatheroftheIridescentFlock.cs - LINE 669
   [HOMING] Vector2 targetDir = (closestNPC.Center - Projectile.Center).SafeNormalize(Vector2.Zero);
   Context: Rainbow shard projectile homing
   Priority: HIGH - Fast projectile needs leading

5. ChromaticSwanSong.cs - LINE 228
   [HOMING] Vector2 toTarget = (target.Center - Projectile.Center).SafeNormalize(Vector2.Zero);
   Context: Feather projectile homing with lerp
   Priority: HIGH - Aggressive homing needs leading

6. FeathersCall.cs - LINE 634
   [HOMING] Vector2 toTarget = (target.Center - Projectile.Center).SafeNormalize(Vector2.Zero);
   Context: Small flare homing toward stored target index
   Priority: MEDIUM - Should offset target position

7. DualFeatherQuiver.cs - LINE 538
   [HOMING] Vector2 direction = (target.Center - Projectile.Center).SafeNormalize(Vector2.Zero);
   Context: Homing feather from accessory
   Priority: HIGH - Strong homing needs leading

================================================================================
CONTENT/FATE/ - 12 INSTANCES
================================================================================

--- FateProjectiles.cs ---

1. LINE 76
   [HOMING] Vector2 targetDir = (closestTarget.Center - Projectile.Center).SafeNormalize(Vector2.Zero);
   Context: Spectral sword homing AI
   Priority: HIGH - Fast homing sword needs leading

2. LINE 372
   [HOMING] Vector2 targetDir = (closestTarget.Center - Projectile.Center).SafeNormalize(Vector2.Zero);
   Context: Cosmic shard homing
   Priority: HIGH - Fast projectile

3. LINE 619
   [ROT] Vector2 toTarget = (target.Center - Projectile.Center).SafeNormalize(Vector2.UnitX);
   Context: Orbiting blade tracking rotation
   Priority: LOW - Rotation only, actual attacks are melee-range

4. LINE 660
   [FIRE] Vector2 direction = (target.Center - Projectile.Center).SafeNormalize(Vector2.UnitX);
   Context: Prismatic crystal firing beam at target
   Priority: MEDIUM - Beam projectile firing direction

5. LINE 885
   [HOMING] Vector2 targetDir = (seekTarget.Center - Projectile.Center).SafeNormalize(Vector2.Zero);
   Context: Star projectile seeking phase
   Priority: HIGH - Aggressive homing (0.2f lerp strength)

--- FateGunSummonProjectiles.cs ---

6. LINE 166
   [ROT] Vector2 toTarget = (target.Center - Projectile.Center).SafeNormalize(Vector2.UnitX);
   Context: Spectral blade rotation to face target
   Priority: NONE - Rotation only

7. LINE 198
   [VFX] Vector2 slashDir = (target.Center - Projectile.Center).SafeNormalize(Vector2.UnitX);
   Context: Slash VFX direction
   Priority: NONE - VFX only

8. LINE 308
   [HOMING] Vector2 targetDir = (target.Center - Projectile.Center).SafeNormalize(Vector2.Zero);
   Context: Cosmic rocket acceleration toward target
   Priority: HIGH - Fast accelerating rocket

9. LINE 450
   [HOMING] Vector2 targetDir = (target.Center - Projectile.Center).SafeNormalize(Vector2.Zero);
   Context: Mini cosmic rocket homing
   Priority: MEDIUM - Light homing (0.08f lerp)

10. LINE 582
    [ROT] Projectile.rotation = (target.Center - Projectile.Center).ToRotation();
    Context: Cosmic deity facing target
    Priority: NONE - Rotation only

11. LINE 662
    [VFX] Vector2 slashDir = (target.Center - Projectile.Center).SafeNormalize(Vector2.UnitX);
    Context: Slash VFX direction
    Priority: NONE - VFX only

12. LINE 682
    [FIRE] Vector2 direction = (target.Center - Projectile.Center).SafeNormalize(Vector2.UnitX);
    Context: Cosmic deity firing beam
    Priority: MEDIUM - Beam firing direction

================================================================================
CONTENT/ENIGMAVARIATIONS/ - 10 INSTANCES
================================================================================

1. Enigma9.cs - LINE 145
   [HOMING] Vector2 toPlayer = (owner.Center - Projectile.Center).SafeNormalize(Vector2.Zero);
   Context: Returning to player (NOT enemy targeting)
   Priority: NONE - Player targeting is OK

2. Enigma8.cs - LINE 569
   [HOMING] Vector2 toTarget = (target.Center - Projectile.Center).SafeNormalize(Vector2.Zero);
   Context: Phantom bolt homing
   Priority: MEDIUM - Moderate homing (0.08f lerp)

3. Enigma6.cs - LINE 622
   [VFX] Vector2 trackDir = (closest.Center - Projectile.Center).SafeNormalize(Vector2.Zero);
   Context: Tracking flare VFX toward closest enemy
   Priority: NONE - VFX indicator only

4. Enigma6.cs - LINE 888
   [HOMING] Vector2 desired = (target.Center - Projectile.Center).SafeNormalize(Vector2.Zero) * Projectile.velocity.Length();
   Context: Paradox shard weak homing
   Priority: LOW - Weak homing (max 0.06f lerp)

5. Enigma4.cs - LINE 364
   [FIRE] Vector2 direction = (target.Center - Projectile.Center).SafeNormalize(Vector2.UnitX);
   Context: Phantom bolt firing direction
   Priority: MEDIUM - The spawned bolt homes anyway

6. Enigma3.cs - LINE 340
   [FIRE] Vector2 direction = (target.Center - Projectile.Center).SafeNormalize(Vector2.UnitX);
   Context: Riddlebolt firing direction
   Priority: LOW - Riddlebolts have their own homing

7. Enigma3.cs - LINE 633
   [HOMING] Vector2 desiredVel = (target.Center - Projectile.Center).SafeNormalize(Vector2.Zero) * MaxSpeed;
   Context: Riddlebolt homing
   Priority: MEDIUM - Moderate homing

8. Enigma2.cs - LINE 625
   [HOMING] Vector2 desiredVel = (target.Center - Projectile.Center).SafeNormalize(Vector2.Zero) * MaxSpeed;
   Context: Watching eye projectile aggressive homing
   Priority: HIGH - Strong homing projectile

9. Enigma10.cs - LINE 347
   [FIRE] Vector2 direction = (target.Center - Projectile.Center).SafeNormalize(Vector2.Zero);
   Context: Paradox beam firing direction
   Priority: MEDIUM - Fast beam projectile

10. EnigmaBossProjectiles.cs - LINE 156
    [HOMING] Vector2 toTarget = (target.Center - Projectile.Center).SafeNormalize(Vector2.Zero);
    Context: Boss projectile homing toward PLAYER
    Priority: NONE - Boss projectiles targeting player are fine

================================================================================
CONTENT/MOONLIGHTSONATA/ - 8 INSTANCES
================================================================================

--- Projectiles ---

1. ResurrectionProjectile.cs - LINE 177
   [HOMING] Vector2 direction = (newTarget.Center - Projectile.Center).SafeNormalize(Vector2.Zero);
   Context: Ricochet direction to next target
   Priority: HIGH - Fast projectile redirecting

2. ResurrectionProjectile.cs - LINE 203
   [VFX] (newTarget.Center - Projectile.Center).SafeNormalize(Vector2.UnitX)
   Context: Spark direction for VFX
   Priority: NONE - VFX only

3. GoliathMoonlightBeam.cs - LINE 76
   [HOMING] Vector2 toTarget = (target.Center - Projectile.Center).SafeNormalize(Vector2.Zero);
   Context: Beam initial tracking
   Priority: HIGH - Fast beam needs leading

4. GoliathMoonlightBeam.cs - LINE 146
   [HOMING] Vector2 newDirection = (nextTarget.Center - Projectile.Center).SafeNormalize(Vector2.Zero);
   Context: Beam ricochet to next target
   Priority: HIGH - Ricochet needs accurate targeting

--- Minions ---

5. RazerOfMoonlightsShadow.cs - LINE 199
   [VFX] Vector2 dustVel = (target.Center - Projectile.Center).SafeNormalize(Vector2.Zero) * 3f;
   Context: Attack particle direction
   Priority: NONE - VFX only

6. RazerOfMoonlightsShadow.cs - LINE 219
   [FIRE] Vector2 toTarget = (target.Center - Projectile.Center).SafeNormalize(Vector2.Zero);
   Context: FireBeam direction
   Priority: MEDIUM - Beam firing, spawned beam may have own tracking

7. GoliathOfMoonlight.cs - LINE 485
   [FIRE] Vector2 toTarget = (target.Center - Projectile.Center).SafeNormalize(Vector2.Zero);
   Context: Devastating beam fire direction
   Priority: MEDIUM - Major attack beam

--- Enemies ---

8. WaningDeer.cs - LINE 1020
   [HOMING] Vector2 direction = (target.Center - Projectile.Center).SafeNormalize(Vector2.Zero);
   Context: Enemy projectile homing
   Priority: NONE - Enemy projectiles targeting player are fine

================================================================================
CONTENT/LACAMPANELLA/ - 10 INSTANCES
================================================================================

--- LaCampanellaRangerWeapons.cs ---

1. LINE 1792
   [HOMING] Vector2 toTarget = (target.Center - Projectile.Center).SafeNormalize(Vector2.Zero);
   Context: Homing rocket aggressive homing
   Priority: HIGH - Fast homing rocket

2. LINE 1870
   [VFX] (target.Center - Projectile.Center).SafeNormalize(Vector2.Zero) * 0.5f
   Context: Hit particle velocity
   Priority: NONE - VFX only

3. LINE 2422
   [HOMING] Vector2 toTarget = (target.Center - Projectile.Center).SafeNormalize(Vector2.Zero);
   Context: Music note projectile homing
   Priority: MEDIUM - Moderate homing

4. LINE 2678
   [HOMING] Vector2 toTarget = (target.Center - Projectile.Center).SafeNormalize(Vector2.Zero);
   Context: Bell note homing after bounce
   Priority: MEDIUM - Post-bounce homing

--- InfernalChimesCalling.cs ---

5. LINE 421
   [FIRE] Vector2 toTarget = (targetNPC.Center - Projectile.Center).SafeNormalize(Vector2.UnitX);
   Context: Choir bell firing flame wave
   Priority: LOW - Flame wave has area effect

6. LINE 547
   [VFX] (npc.Center - Projectile.Center).SafeNormalize(Vector2.UnitX)
   Context: Spark direction on cascade hits
   Priority: NONE - VFX only

--- FangOfTheInfiniteBell.cs ---

7. LINE 515
   [VFX] Vector2 hitDir = (target.Center - Projectile.Center).SafeNormalize(Vector2.UnitX);
   Context: Hit effect direction
   Priority: NONE - VFX only

--- DualFatedChime.cs ---

8. LINE 601
   [VFX] Vector2 hitDirection = (target.Center - Projectile.Center).SafeNormalize(Vector2.UnitX);
   Context: Hit VFX direction
   Priority: NONE - VFX only

9. LINE 952
   [VFX] Vector2 hitDir = (target.Center - Projectile.Center).SafeNormalize(Vector2.UnitX);
   Context: Hit VFX direction
   Priority: NONE - VFX only

10. LINE 1092
    [VFX] Vector2 hitDir = (target.Center - Projectile.Center).SafeNormalize(Vector2.UnitX);
    Context: Hit VFX direction
    Priority: NONE - VFX only

================================================================================
SUMMARY - PRIORITY ITEMS TO FIX
================================================================================

HIGH PRIORITY (Fast homing projectiles that need target leading):
----------------------------------------------------------------
1. SwanLake/FeatheroftheIridescentFlock.cs:669 - Rainbow shard homing
2. SwanLake/ChromaticSwanSong.cs:228 - Feather homing
3. SwanLake/DualFeatherQuiver.cs:538 - Accessory feather homing
4. Fate/FateProjectiles.cs:76 - Spectral sword homing
5. Fate/FateProjectiles.cs:372 - Cosmic shard homing
6. Fate/FateProjectiles.cs:885 - Star projectile seeking (0.2f lerp!)
7. Fate/FateGunSummonProjectiles.cs:308 - Cosmic rocket acceleration
8. EnigmaVariations/Enigma2.cs:625 - Watching eye homing
9. MoonlightSonata/ResurrectionProjectile.cs:177 - Ricochet redirect
10. MoonlightSonata/GoliathMoonlightBeam.cs:76 - Beam tracking
11. MoonlightSonata/GoliathMoonlightBeam.cs:146 - Beam ricochet
12. LaCampanella/LaCampanellaRangerWeapons.cs:1792 - Homing rocket

MEDIUM PRIORITY (Moderate homing or projectile spawning):
---------------------------------------------------------
1. SwanLake/IridescentWingspan.cs:293 - Feather homing
2. SwanLake/FeathersCall.cs:634 - Flare homing
3. Fate/FateProjectiles.cs:660 - Prismatic beam firing
4. Fate/FateGunSummonProjectiles.cs:450 - Mini rocket homing
5. Fate/FateGunSummonProjectiles.cs:682 - Deity beam firing
6. EnigmaVariations/Enigma8.cs:569 - Phantom bolt homing
7. EnigmaVariations/Enigma4.cs:364 - Phantom bolt firing
8. EnigmaVariations/Enigma3.cs:633 - Riddlebolt homing
9. EnigmaVariations/Enigma10.cs:347 - Paradox beam firing
10. MoonlightSonata/RazerOfMoonlightsShadow.cs:219 - Beam firing
11. MoonlightSonata/GoliathOfMoonlight.cs:485 - Devastating beam
12. LaCampanella/LaCampanellaRangerWeapons.cs:2422 - Note homing
13. LaCampanella/LaCampanellaRangerWeapons.cs:2678 - Bell note homing

LOW PRIORITY (Weak homing, spawns other homing projectiles, or area attacks):
-----------------------------------------------------------------------------
1. SwanLake/FeatheroftheIridescentFlock.cs:444 - Fires homing flare
2. EnigmaVariations/Enigma6.cs:888 - Weak homing (max 0.06f)
3. EnigmaVariations/Enigma3.cs:340 - Fires homing riddlebolt
4. LaCampanella/InfernalChimesCalling.cs:421 - Area flame wave

OK AS-IS (VFX, rotation, player targeting, or distance checks):
---------------------------------------------------------------
- All [VFX] tagged items - visual effects only
- All [ROT] tagged items - rotation facing only
- All [DIST] tagged items - distance checks only
- Boss/enemy projectiles targeting players
- Projectiles returning to player

================================================================================
RECOMMENDED FIX PATTERN
================================================================================

Instead of:
    Vector2 direction = (target.Center - Projectile.Center).SafeNormalize(Vector2.Zero);

Use:
    // Calculate predicted position based on target velocity and projectile speed
    float projectileSpeed = 16f; // Your projectile's speed
    float distToTarget = Vector2.Distance(Projectile.Center, target.Center);
    float timeToReach = distToTarget / projectileSpeed;
    Vector2 predictedPos = target.Center + target.velocity * timeToReach * 0.5f; // 50% prediction
    Vector2 direction = (predictedPos - Projectile.Center).SafeNormalize(Vector2.Zero);

Or use a helper method in BossAIUtilities or similar.

================================================================================
